# 理解阻塞、非阻塞与同步、异步的区别

## 同步和异步

同步和异步关注的是**消息通信机制。**

所谓同步，就是在发出一个调用时，在没有得到结果之前，这个调到用就不返回。但是！！！一旦调用返回，就得到返回值了。换句话说，就是由**调用者主动等待这个调用的结果。**

所谓异步，就是在发出一个调用后，这个调用就直接返回了，所以就没有返回结果，换句话说，一个异步过程调用发出后，调用者不会立刻得到结果，而是在调用发出之后，被调用者通过“状态”、“通知”、“回调”三种途径通知调用者。

可以使用哪一种途径依赖于被带调用者的实现，除非被调用者提供多种选择，否则不受调用者控制。如果被调用者用状态来通知，那么调用者就需要每隔一定时间检查一次，效率就很低。如果使用通知和回调的方式，效率则很高。因为被调用者几乎不需要做额外的操作。

### 举个例子：

你打电话问书店老板有没有《分布式系统》这本书，如果是同步通信机制，书店老板会说，你稍等，”我查一下"，然后开始查啊查，等查好了（可能是5秒，也可能是一天）告诉你结果（返回结果）。

而异步通信机制，书店老板直接告诉你我查一下啊，查好了打电话给你，然后直接挂电话了（不返回结果）。然后查好了，他会主动打电话给你。在这里老板通过“回电”这种方式来回调。

## 回调函数

上面提到，回调是异步调用的一种方式，那么什么是回调函数呢？

**概念**

回调函数就是一个通过[函数指针](https://link.zhihu.com/?target=http%3A//baike.baidu.com/view/1604730.htm)调用的函数。就比如调用者把函数的[指针](https://link.zhihu.com/?target=http%3A//baike.baidu.com/view/159417.htm)（地址）作为[参数传递](https://link.zhihu.com/?target=http%3A//baike.baidu.com/view/2691131.htm)给被调用者，当这个指针被被调用者用来调用其所指向的函数时，我们就说这是回调函数。回调函数不是由该函数的实现方直接调用，而是在特定的事件或条件发生时由另外的一方调用的，用于对该事件或条件进行响应。

**举个例子**

概念不是太好理解，我们举个例子。

沿用上面买书的例子，你的电话号码就叫**回调函数**，你把电话留给书店老板就叫**登记回调函数**，书店老板查好了叫做触发了回调关联的事件（处理逻辑，可能是IO操作），（IO完成后，回调）老板给你打电话叫做**调用回调函数。**你接电话叫做响应回调事件。

##  阻塞与非阻塞

阻塞与非阻塞关注是**程序在等待调用结果（消息，返回值）时的状态。**

阻塞调用是指调用结果返回之前，当前发出请求调用的线程会被挂起，只有在得到结果之后，才会返回。

非阻塞调用是指在不能立刻得到结果之前，该调用不会阻塞当前进程。

接着上面的例子：

你打电话问书店老板有没有《分布式系统》这本书

- 你如果是阻塞式调用，你会一直把自己“挂起”，直到得到这本书有没有的结果
- 如果是非阻塞式调用，你不管老板有没有告诉你，你自己先一边去玩了， 当然你也要偶尔过几分钟check一下老板有没有返回结果。

## 故事描述

老张爱喝茶，废话不说，煮开水。
出场人物：老张，水壶两把（普通水壶，简称水壶；会响的水壶，简称响水壶）。

### 情况1

老张把水壶放到火上，立等水开。（同步阻塞）老张觉得自己有点傻。

![输入图片说明](https://static.oschina.net/uploads/img/201604/20150405_VKYH.png)

### 情况2

老张把水壶放到火上，去客厅看电视，时不时去厨房看看水开没有。（同步非阻塞）

![输入图片说明](https://static.oschina.net/uploads/img/201604/20152818_DXcj.png)

老张还是觉得自己有点傻，于是变高端了，买了把会响笛的那种水壶。水开之后，能大声发出嘀~~~~的噪音。

### 情况3

老张把响水壶放到火上，立等水开。（异步阻塞）。

### 情况4	

老张觉得这样傻等意义不大，老张把响水壶放到火上，去客厅看电视，水壶响之前不再去看它了，响了再去拿壶。（异步非阻塞）。

![输入图片说明](https://static.oschina.net/uploads/img/201604/20175459_gtgw.png)



所谓同步异步，**只是对于水壶而言。**普通水壶，同步；响水壶，异步。虽然都能干活，但响水壶可以在自己完工之后，提示老张水开了。这是普通水壶所不能及的。同步只能让调用者去轮询自己（情况2中），造成老张效率的低下。

所谓阻塞非阻塞，**仅仅对于老张而言。**立等的老张，阻塞；看电视的老张，非阻塞。

情况1和情况3中老张就是阻塞的，媳妇喊他都不知道。虽然3中响水壶是异步的，可对于立等的老张没有太大的意义。**所以一般异步是配合非阻塞使用的，这样才能发挥异步的效用。**

















