## 进程间的通信方式

主要有一下几种

1. 管道，包括匿名管道、命名管道
2. 信号
3. 信号量
4. 消息队列
5. 共享内存
6. 本地套接字

### 管道

管道是一种半双工的通信方式，数据只能单向流动

#### 匿名管道

匿名管道只能在具有亲缘关系的进程间使用，进程的亲缘关系通常指父子进程关系

```java
// 需要的头文件
#include <unistd.h>

// 通过pipe()函数来创建匿名管道
// 返回值：成功返回0，失败返回-1
// fd参数返回两个文件描述符
// fd[0]指向管道的读端，fd[1]指向管道的写端
// fd[1]的输出是fd[0]的输入。
int pipe (int fd[2]);
```

使用匿名管道进行进程间的通信的过程，可以用下面例子说明

- 父进程创建管道，得到两个文件描述符指向管道的两端
- 父进程fork出子进程，子进程也有两个文件描述符指向同⼀管道
- 父进程关闭 fd[0]，子进程关闭 fd[1]，即父进程关闭管道读端，子进程关闭管道写端（因为管道只支持单向通信）。⽗进程可以往管道⾥写,子进程可以从管道⾥读,管道是⽤环形队列实现的,数据从写端流从从读端流出,这样就实现了进程间通信

### 命名管道

不同于匿名管道之处在于它提供一个路径名与之关联，以FIFO的文件形式存在于文件系统中。这样，即使与FIFO的创建进程不存在亲缘关系的进程，只要可以访问该路径，就能够彼此通过FIFO相互通信（能够访问该路径的进程与FIFO的创建进程之间通信），因此，通过FIFO不相关的进程也能交换数据。值得注意的是，FIFO严格遵循先进先出（first in first out），对管道及FIFO的读总是从开始处返回数据，对它们的写则把数据添加到末尾

### 信号

信号是一种比较复杂的通信方式，信号产生的条件：按键、硬件异常、进程调用kill函数将信号发送给另一个进程、用户调用kill命令将信号发送给其他进程，信号传递的消息比较少，主要用于通知接收进程某个事件已经发生

### 信号量

信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段

### 消息队列

消息队列是消息的链表，存放在内核中并由消息队列标识符标识，消息队列克服了信号传递信息少，管道只能承载无格式字节流以及缓冲区大小受限等特点。消息队列起信箱作用，到了就挂在那里，需要的时候去取。消息队列提供了一种在两个不相关进程间传递数据的简单有效的方法。与命名管道相比：消息队列的优势在于，它独立于发送和接收进程而存在，这消除了在同步命名管道的打开和关闭时可能产生的一些困难

### 共享内存

共享内存( shared memory ) ：共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式(不需要从用户态到内核态的切换)，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号量，配合使用，来实现进程间的同步和通信

### 本地套接字

进程间通信的一种方式是使用UNIX套接字sockaddr_un，人们在使用这种方式时往往用的不是网络套接字，而是一种称为本地套接字的方式。本地套接字用于本地进程间的通讯更安全和稳定

使用套接字函数socket创建，不过传递的参数与网络套接字不同。域参数应该是PF_LOCAL或者PF_UNIX，而不能用PF_INET之类。本地套接字的通讯类型应该是SOCK_STREAM或SOCK_DGRAM，协议为默认协议

创建了套接字后，还必须进行绑定才能使用。不同于网络套接字的绑定，本地套接字的绑定的是struct sockaddr_un结构。struct sockaddr_un结构有两个参数：sun_family、sun_path。sun_family只能是AF_LOCAL或AF_UNIX，而sun_path是本地文件的路径。通常将文件放在/tmp目录下

本地套接字的其他操作都与网络套接字相似


## 线程间的通信方式

### 锁机制：

包括互斥锁、条件变量、读写锁

- 互斥锁提供了以排他方式防止数据结构被并发修改的方法
- 读写锁允许多个线程同时读共享数据，而对写操作是互斥的
- 条件变量可以以原子的方式阻塞进程，直到某个特定条件为真为止。对条件的测试是在互斥锁的保护下进行的。条件变量始终与互斥锁一起使用

### 信号量机制(Semaphore)：

包括无名线程信号量和命名线程信号量

### 信号机制(Signal)：

类似进程间的信号处理，线程间的通信目的主要是用于线程同步，所以线程没有像进程通信中的用于数据交换的通信机制