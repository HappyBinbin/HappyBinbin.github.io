# 位运算

## 概览

| 符号 | 描述 | 运算规则                                                     |
| :--- | :--- | :----------------------------------------------------------- |
| &    | 与   | 两个位都为1时，结果才为1                                     |
| \|   | 或   | 两个位都为0时，结果才为0                                     |
| ^    | 异或 | 两个位相同为0，相异为1                                       |
| ~    | 取反 | 0变1，1变0                                                   |
| <<   | 左移 | 各二进位全部左移若干位，高位丢弃，低位补0                    |
| >>   | 右移 | 各二进位全部右移若干位，对无符号数，高位补0，有符号数，各编译器处理方法不一样，有的补符号位（算术右移），有的补0（逻辑右移） |

## 按位与 &

**定义**：参加运算的两个数据，按二进制位进行"与"运算。

运算规则：

```java
0&0=0  0&1=0  1&0=0  1&1=1
```

总结：两位同时为1，结果才为1，否则结果为0。

例如：3&5 即 0000 0011& 0000 0101 = 0000 0001，因此 3&5 的值得1。

注意：负数按补码形式参加按位与运算。

### 用途：

#### 1. 清零

如果想将一个单元清零，即使其全部二进制位为0，只要与一个各位都为零的数值相与，结果为零。

#### 2. 取一个数的指定位

比如取数 X=1010 1110 的低4位，只需要另找一个数Y，令Y的低4位为1，其余位为0，即Y=0000 1111，然后将X与Y进行按位与运算（X&Y=0000 1110）即可得到X的指定位。

#### 3. 判断奇偶

只要根据最未位是0还是1来决定，为0就是偶数，为1就是奇数。因此可以用if ((a & 1) == 0)代替if (a % 2 == 0)来判断a是不是偶数。

#### 4. n&(n-1)

n&(n-1)作用：

- 将n的二进制表示中的最低位为1的改为0

先看一个简单的例子：

n = 10100(二进制），则(n-1) = 10011 => n&(n-1) = 10000

可以看到原本最低位为1的那位变为0。弄明白了n&(n-1)的作用，那它有哪些应用？

##### 判断一个数是否是2的方幂

n > 0 && ((n & (n - 1)) == 0 )

解释((n & (n-1)) == 0)：

- 如果A&B==0，表示A与B的二进制形式没有在同一个位置都为1的时候。

那么本题到底啥意思？？

不妨先看下n-1是什么意思。

> 令:n=1101011000(二进制,十进制也一样)，则
>
> n-1=1101010111。
>
> n&(n-1)=1101010000

由此可以得出，n和n-1的低位不一样，直到有个转折点，就是借位的那个点，从这个点开始的高位，n和n-1都一样，如果高位一样这就造成一个问题，就是n和n-1在相同的位上可能会有同一个1，从而使((n & (n-1)) != 0)，如果想要 ((n & (n-1)) == 0)，则高位必须全为0，这样就没有相同的1。

> n = 1000
>
> n-1 = 0111
>
> n & (n-1) = 0000
>
> 所以 n 是 2的幂 或 0

##### 求某一个数的二进制表示中1的个数

```java
while (n >0 ) {
   count ++;
   n &= (n-1);
}
```

##### 计算N!的质因数2的个数。

容易得出N!质因数2的个数 = [N / 2] + [N / 4] + [N / 8] + ....
下面通过一个简单的例子来推导一下过程：N = 10101(二进制表示）
现在我们跟踪最高位的1，不考虑其他位假定为0，
则在
[N / 2]  01000
[N / 4]  00100
[N / 8]  00010
[N / 8]  00001
则所有相加等于01111 = 10000 - 1
由此推及其他位可得：(10101)!的质因数2的个数为10000 - 1 + 00100 - 1 + 00001 - 1 = 10101 - 3(二进制表示中1的个数)

推及**一般N!的质因数2的个数为N-(N二进制表示中1的个数)**

## 按位或 |

**定义：**参加运算的两个对象，按二进制位进行"或"运算。

运算规则：

```java
0|0=0  0|1=1  1|0=1  1|1=1
```

总结：有1为1，无1为0

例如：3|5即 0000 0011| 0000 0101 = 0000 0111，因此，3|5的值得7。

### 用途

#### 常用来对一个数据的某些位设置为1

比如将数 X=1010 1110 的低4位设置为1，只需要另找一个数Y，令Y的低4位为1，其余位为0，即Y=0000 1111，然后将X与Y进行按位或运算（X|Y=1010 1111）即可得到。

## 按位异或 ^

**定义：**参加运算的两个数据，按二进制位进行"异或"运算。

运算规则：

```java
0^0=0  0^1=1  1^0=1  1^1=0
```

总结：参加运算的两个对象，如果两个相应位相同为0，相异为1,就是 **模2加法**

异或的几条性质:

- 1、交换律
- 2、结合律 (a^b)^c == a^(b^c)
- 3、对于任何数x，都有 x^x=0，x^0=x
- 4、自反性: a^b^b=a^0=a;

### 用途

#### 1. 翻转指定位

比如将数 X=1010 1110 的低4位进行翻转，只需要另找一个数Y，令Y的低4位为1，其余位为0，即Y=0000 1111，然后将X与Y进行异或运算（X^Y=1010 0001）即可得到。

#### 2. 与0相异或值不变

例如：1010 1110 ^ 0000 0000 = 1010 1110

#### 3. 交换两个数

```java
void Swap(int &a, int &b){
    if (a != b){
        a ^= b;
        b ^= a;
        a ^= b;
    }
}
```

## 按位取反 ~

**定义：**参加运算的一个数据，按二进制进行"取反"运算。

运算规则：　

```java
~1=0
~0=1
```

总结：对一个二进制数按位取反，即将0变1，1变0。

## 左移 <<

**定义：**将一个运算对象的各二进制位全部左移若干位（左边的二进制位丢弃，右边补0）。

设 a=1010 1110，a = a<< 2 将a的二进制位左移2位、右补0，即得a=1011 1000。

若左移时舍弃的高位不包含1，则每左移一位，**相当于该数乘以2。**

## 右移 >>

**定义：**将一个数的各二进制位全部右移若干位，正数左补0，负数左补1，右边丢弃。

例如：a=a>>2 将a的二进制位右移2位，左补0 或者 左补1得看被移数是正还是负。

操作数每右移一位，**相当于该数除以2。**







