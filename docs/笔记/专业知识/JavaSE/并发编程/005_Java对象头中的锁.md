# 认识Java 对象头中的锁

1. 理解 Mark Word

## 从Mark Word 认识锁

在 HotSpot 虚拟机中，一个对象由三个不存组成

- 对象头 Header
    - Mark Word
    - Klass Pointer
- 实例数据：对象的成员变量和数据
- 对齐填充：顾名思义，对齐

## Mark Word 主要组成

- 哈希码
- GC 分带年龄
- 锁状态标志
- 偏向线程 ID

如果一个线程想访问某个对象的实例，那么这个线程必须拥有该对象的**锁**。

首先，它需要通过对象头中的Mark Word判断该对象的实例是否已经被线程锁定。如果没有锁定，**那么线程会在Mark Word中写入一些标记数据**，就是告诉别人：这个对象是我的啦！如果其他线程想访问这个实例的话，就需要进入等待队列，直到当前的线程释放对象的锁，也就是把Mark Word中的数据擦除。

**当一个线程拥有了锁之后，它便可以多次进入**。当然，在这个线程释放锁的时候，那么也需要执行相同次数的释放动作。比如，一个线程先后3次获得了锁，那么它也需要释放3次，其他线程才可以继续访问。

下面的表格展示的是64位计算机中的对象头信息：

- Mark Word
- Klass Word
- State

![image-20211213110621076](https://gitee.com/HappyBinbin/pcigo/raw/master/image-20211213110621076.png)





















































