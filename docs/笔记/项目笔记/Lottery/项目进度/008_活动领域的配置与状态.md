# æ´»åŠ¨é¢†åŸŸçš„é…ç½®ä¸çŠ¶æ€

## å­¦ä¹ ç›®çš„

- åˆ†æ”¯ 20220218_happy_activity

- å¼€å‘æ´»åŠ¨é¢†åŸŸéƒ¨åˆ†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼šæ´»åŠ¨åˆ›å»ºã€æ´»åŠ¨çŠ¶æ€å˜æ›´ã€‚ä¸»è¦ä»¥ domain é¢†åŸŸå±‚ä¸‹æ·»åŠ  activity ä¸ºä¸»ï¼Œå¹¶åœ¨å¯¹åº”çš„ service ä¸­æ·»åŠ  deploy(åˆ›å»ºæ´»åŠ¨)ã€partake(é¢†å–æ´»åŠ¨ï¼Œå¾…å¼€å‘)ã€stateflow(çŠ¶æ€æµè½¬)ä¸‰ä¸ªæ¨¡å—
- è°ƒæ•´ä»“å‚¨æœåŠ¡ï¼Œå°†å…¶å®ç°æ”¾ç½®åˆ°åŸºç¡€å±‚

## å¼€å‘æ—¥å¿—

- æŒ‰ç…§ DDD æ¨¡å‹ï¼Œè°ƒæ•´åŒ…å¼•ç”¨ lottery-infrastructure å¼•å…¥ lottery-domainï¼Œè°ƒæ•´åæ•ˆæœï¼š`é¢†åŸŸå±‚ domain` å®šä¹‰ä»“å‚¨æ¥å£ï¼Œ`åŸºç¡€å±‚ infrastructure` å®ç°ä»“å‚¨æ¥å£ã€‚
- æ´»åŠ¨é¢†åŸŸå±‚éœ€è¦æä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼šæ´»åŠ¨åˆ›å»ºã€æ´»åŠ¨çŠ¶æ€å¤„ç†å’Œç”¨æˆ·é¢†å–æ´»åŠ¨æ“ä½œï¼Œæœ¬ç« èŠ‚å…ˆå®ç°å‰ä¸¤ä¸ªéœ€æ±‚ï¼Œä¸‹ä¸ªç« èŠ‚ç»§ç»­å¼€å‘å…¶ä»–åŠŸèƒ½ã€‚
- æ´»åŠ¨åˆ›å»ºçš„æ“ä½œä¸»è¦ä¼šç”¨åˆ°äº‹åŠ¡ï¼Œå› ä¸ºæ´»åŠ¨ç³»ç»Ÿæä¾›ç»™è¿è¥åå°åˆ›å»ºæ´»åŠ¨æ—¶ï¼Œéœ€è¦åŒ…æ‹¬ï¼šæ´»åŠ¨ä¿¡æ¯ã€å¥–å“ä¿¡æ¯ã€ç­–ç•¥ä¿¡æ¯ã€ç­–ç•¥æ˜ç»†ä»¥åŠå…¶ä»–é¢å¤–æ‰©å±•çš„å†…å®¹ï¼Œè¿™äº›ä¿¡æ¯éƒ½éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸‹è¿›è¡Œè½åº“ã€‚
- æ´»åŠ¨çŠ¶æ€çš„å®¡æ ¸ï¼Œã€1ç¼–è¾‘ã€2æå®¡ã€3æ’¤å®¡ã€4é€šè¿‡ã€5è¿è¡Œ(å®¡æ ¸é€šè¿‡åworkeræ‰«æçŠ¶æ€)ã€6æ‹’ç»ã€7å…³é—­ã€8å¼€å¯ã€‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šç”¨åˆ°è®¾è®¡æ¨¡å¼ä¸­çš„`çŠ¶æ€æ¨¡å¼`è¿›è¡Œå¤„ç†ã€‚

## DDD æ¨¡å‹é€‚é…

åŸæœ‰å·¥ç¨‹åœ¨ lottery-domain ä¸­å®šä¹‰ repository å®ç°ä»“å‚¨æœåŠ¡ï¼ŒæŒ‰ç…§ DDD æ¨¡å‹è¿›è¡Œæ”¹é€ ï¼šåœ¨ lottery-domain é¢†åŸŸå±‚å®šä¹‰ä»“å‚¨æ¥å£ï¼Œåœ¨ lottery-infrastructure åŸºç¡€å±‚å®ç°ä»“å‚¨æ¥å£ï¼Œä»¥ award é¢†åŸŸä¸¾ä¾‹ï¼š

ä¸¤å¹…å›¾åˆ†åˆ«ä¸ºï¼šæ”¹é€ å‰ and æ”¹é€ å

<img src="https://happychan.oss-cn-shenzhen.aliyuncs.com/img/image-20220218235632568.png" alt="image-20220218235632568" style="zoom:80%;" />

### æ„å»ºè¿‡ç¨‹

#### ä¾èµ–è°ƒæ•´

- lottery-infrastructure è¦å®ç°ä»“å‚¨æœåŠ¡ï¼Œåˆ™éœ€è¦åº”ç”¨ lottery-domain ä¾èµ–ï¼Œlottery-domainå–æ¶ˆåŸæœ‰å¯¹lottery-infrastructure çš„ä¾èµ–ï¼ˆé¿å…å¾ªç¯ä¾èµ–ï¼‰

### ç±»å‹è°ƒæ•´

- ç”±äºéœ€è¦é¿å…å¾ªç¯ä¾èµ–ï¼Œåˆ™åŸæœ‰ lottery-domain å¯¹ åŸºç¡€å±‚çš„åŸºç¡€ç±»çš„ä¾èµ–åˆ™è¦è¿›è¡Œè§£ç»‘ã€‚é€šè¿‡ BriefVO çš„å½¢å¼ï¼Œåœ¨ domain ä¸­å®šä¹‰éœ€è¦çš„åŸºç¡€ç±»ã€‚
- ä¿®æ”¹ç›¸åº”éœ€è¦å¼•ç”¨åˆ°åœ°æ–¹

### é¢†åŸŸæ„å»º

- lottery-domain ä¸­ activity é¢†åŸŸçš„æ„å»ºï¼Œmodelã€repositoryã€service 
- lottery-infrastructure åŸºç¡€å±‚ä¸­å®ç°ä»“å‚¨æ¥å£
- lottery-common ä¸­æ–°å¢æ´»åŠ¨çŠ¶æ€æšä¸¾ç±» Constant.ActivityState
- lottery-interfaces æ–°å¢æ´»åŠ¨ç­‰æ“ä½œæ•°æ®åº“æ¥å£ä»¥åŠå¯¹åº”çš„ mapper æ–‡ä»¶ sql å†™å…¥



## æ´»åŠ¨é¢†åŸŸæ„å»º

### å·¥ç¨‹ç»“æ„

```basic
lottery-domain
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ cn.itedus.lottery.domain.activity
                â”œâ”€â”€ model
                â”œâ”€â”€ repository
                â”‚   â””â”€â”€ IActivityRepository
                â””â”€â”€ service
                    â”œâ”€â”€ deploy
                    â”œâ”€â”€ partake [å¾…å¼€å‘]
                    â””â”€â”€ stateflow
                        â”œâ”€â”€ event
                        â”‚   â”œâ”€â”€ ArraignmentState.java
                        â”‚   â”œâ”€â”€ CloseState.java
                        â”‚   â”œâ”€â”€ DoingState.java
                        â”‚   â”œâ”€â”€ EditingState.java
                        â”‚   â”œâ”€â”€ OpenState.java
                        â”‚   â”œâ”€â”€ PassState.java
                        â”‚   â””â”€â”€ RefuseState.java
                        â”œâ”€â”€ impl
                        â”‚   â””â”€â”€ StateHandlerImpl.java
                        â”œâ”€â”€ AbstractState.java
                        â”œâ”€â”€ IStateHandler.java
                        â””â”€â”€ StateConfig.java
```

### æ´»åŠ¨å‘å¸ƒï¼ˆåˆ›å»ºï¼‰

- æ´»åŠ¨çš„åˆ›å»ºæ“ä½œä¸»è¦åŒ…æ‹¬ï¼šæ·»åŠ æ´»åŠ¨é…ç½®ã€æ·»åŠ å¥–å“é…ç½®ã€æ·»åŠ ç­–ç•¥é…ç½®ã€æ·»åŠ ç­–ç•¥æ˜ç»†é…ç½®ï¼Œè¿™äº›éƒ½æ˜¯åœ¨åŒä¸€ä¸ªæ³¨è§£äº‹åŠ¡é…ç½®ä¸‹è¿›è¡Œå¤„ç† `@Transactional(rollbackFor = Exception.class)`
- è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¥–å“é…ç½®å’Œç­–ç•¥é…ç½®éƒ½æ˜¯é›†åˆå½¢å¼çš„ï¼Œè¿™é‡Œä½¿ç”¨äº† Mybatis çš„ä¸€æ¬¡æ’å…¥å¤šæ¡æ•°æ®é…ç½®ã€‚

```java
public class ActivityDeployImpl implements IActivityDeploy {

    private Logger logger = LoggerFactory.getLogger(ActivityDeployImpl.class);

    @Resource
    private IActivityRepository activityRepository;

    @Transactional(rollbackFor = Exception.class)
    @Override
    public void createActivity(ActivityConfigReq req) {
        logger.info("åˆ›å»ºæ´»åŠ¨é…ç½®å¼€å§‹ï¼ŒactivityIdï¼š{}", req.getActivityId());
        ActivityConfigRich activityConfigRich = req.getActivityConfigRich();
        try {
            // æ·»åŠ æ´»åŠ¨é…ç½®
            ActivityVO activity = activityConfigRich.getActivity();
            activityRepository.addActivity(activity);

            // æ·»åŠ å¥–å“é…ç½®
            List<AwardVO> awardList = activityConfigRich.getAwardList();
            activityRepository.addAward(awardList);

            // æ·»åŠ ç­–ç•¥é…ç½®
            StrategyVO strategy = activityConfigRich.getStrategy();
            activityRepository.addStrategy(strategy);

            // æ·»åŠ ç­–ç•¥æ˜ç»†é…ç½®
            List<StrategyDetailVO> strategyDetailList = activityConfigRich.getStrategy().getStrategyDetailList();
            activityRepository.addStrategyDetailList(strategyDetailList);

            logger.info("åˆ›å»ºæ´»åŠ¨é…ç½®å®Œæˆï¼ŒactivityIdï¼š{}", req.getActivityId());
        } catch (DuplicateKeyException e) {
            logger.error("åˆ›å»ºæ´»åŠ¨é…ç½®å¤±è´¥ï¼Œå”¯ä¸€ç´¢å¼•å†²çª activityIdï¼š{} reqJsonï¼š{}", req.getActivityId(), JSON.toJSONString(req), e);
            throw e;
        }
    }

    @Override
    public void updateActivity(ActivityConfigReq req) {
        // TODO: éæ ¸å¿ƒåŠŸèƒ½åç»­è¡¥å……
    }

}
```

### æ´»åŠ¨çŠ¶æ€æµè½¬ï¼ˆçŠ¶æ€å˜æ›´ï¼šçŠ¶æ€æ¨¡å¼ï¼‰

å¯¹äºçŠ¶æ€æ¨¡å¼çš„ä»‹ç»ï¼Œ=> [çŠ¶æ€æ¨¡å¼-ä¸ªäººç¬”è®°](https://gitee.com/HappyBinbin/my-notes/blob/master/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A1%8C%E4%B8%BA%E5%9E%8B/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F.md)

- ä¸šåŠ¡æµè½¬ï¼šåªéœ€è€ƒè™‘å½“å‰èŠ‚ç‚¹èƒ½å¦æµè½¬åˆ°ä¸‹ä¸€èŠ‚ç‚¹
- ä¸šåŠ¡åŠŸèƒ½é™åˆ¶ï¼šéœ€è€ƒè™‘å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼ˆå¯é™åˆ¶åŠŸèƒ½è®¿é—®ç”šè‡³æ˜¯é™åˆ¶èŠ‚ç‚¹çš„æµè½¬ï¼‰

<img src="https://happychan.oss-cn-shenzhen.aliyuncs.com/img/image-20220219002123670.png">

<img src="https://happychan.oss-cn-shenzhen.aliyuncs.com/img/image-20220219002123670.png" alt="image-20220219002123670" style="zoom:80%;" />

ä¾æ®æµç¨‹åˆ†ææ¯ä¸ªçŠ¶æ€èŠ‚ç‚¹çš„çŠ¶æ€å’Œæµè½¬ï¼Œåªè€ƒè™‘å½“å‰èŠ‚ç‚¹çŠ¶æ€çš„å‡ºå…¥åˆ†æã€‚é’ˆå¯¹æŸä¸ªçŠ¶æ€èŠ‚ç‚¹åªè€ƒè™‘â€œå‡ºâ€çš„æƒ…å†µï¼Œå³ç”±å½“å‰èŠ‚ç‚¹å’Œå¯ä»¥æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼ˆå˜æ›´ä¸ºæŒ‡å®šçŠ¶æ€ï¼‰ï¼Œâ€œå…¥â€çš„æƒ…å†µåˆ™å¯åœ¨å…¶ä»–çŠ¶æ€ä¸­ä½“ç°

- ç¼–è¾‘æ€
    - å¯æ‰§è¡Œæå®¡æ“ä½œ
    - æ´»åŠ¨å¯å…³é—­
- æå®¡æ€
    - å¯æ‰§è¡Œæ’¤å®¡æ“ä½œ
    - å…·æœ‰ç®¡ç†å‘˜æƒé™ç”¨æˆ·å¯å®¡æ ¸æ´»åŠ¨ï¼Œâ€œé€šè¿‡â€ã€â€œä¸é€šè¿‡â€
    
    ç­‰ç­‰

<img src="https://happychan.oss-cn-shenzhen.aliyuncs.com/img/image-20220219002515330.png" alt="image-20220219002515330" style="zoom:80%;" />

#### å…·ä½“å®ç°è®¾è®¡

1ã€æŠ½è±¡ç±» AbstractStateï¼Œæä¾›æ‰€æœ‰çŠ¶æ€æ¥å£

```java
@Component
public class AbstractState {
    @Resource
    protected IActivityRepository activityRepository;
    /**
    * æµè½¬æ“ä½œ
    * activityId:æ´»åŠ¨ID
    * currentState:æ´»åŠ¨çŠ¶æ€æšä¸¾ å¯¹åº”å½“å‰æ´»åŠ¨çŠ¶æ€
    */
    public abstract Result stateFlow(Long activityId, Enum<Constants.ActivityState>
                                     currentState);
}
```

2ã€å®šä¹‰æ‰€æœ‰æ´»åŠ¨çŠ¶æ€ï¼Œç»§æ‰¿ AbstractStateï¼Œå®ç°å„è‡ªåœ¨å½“å‰çŠ¶æ€ä¸‹å‘æ‰€æœ‰çŠ¶æ€çš„è½¬æ¢å…·ä½“æ“ä½œ

```java
@Component
public class xxxState extends AbstractState {
    @Override
    public Result stateFlow(Long activityId, Enum<Constants.ActivityState>
                       currentState) {
        // 1.æµè½¬çŠ¶æ€æ ¡éªŒ:æ ¹æ®å½“å‰çŠ¶æ€è¿›è¡Œåˆ¤æ–­æˆ–è€…å…¶ä»–é™åˆ¶åˆ¤æ–­æ˜¯å¦æ”¾è¡Œ
        // 2.å¦‚æœæ ¡éªŒæ­£å¸¸åˆ™æ‰§è¡Œæµè½¬æ“ä½œï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘
        return Result.buildResult(Constants.ResponseCode.SUCCESS, "xxx");
    }
}
```

3ã€StateConfigï¼Œé…ç½®å¹¶çŠ¶æ€æ‰€æœ‰çŠ¶æ€ï¼Œæä¾›ç­–ç•¥ç»„ Map<Enum<Constants.ActivityState>, AbstractState>

```java
public class StateConfig {
    @Resource
    private xxxState xxxState;
    protected Map<Enum<Constants.ActivityState>, AbstractState> stateGroup = new
        ConcurrentHashMap<>();
    @PostConstruct
    public void init() {
        // å°†æŒ‡å®šçŠ¶æ€è£…è½½å…¥map
        stateGroup.put(Constants.ActivityState.xxxState, xxxState);
    }
}
```

4ã€æŠ½ç¦» IStateHandler æ¥å£ï¼ˆä¹Ÿå®šä¹‰äº†æ‰€æœ‰çŠ¶æ€æ¥å£ï¼‰ï¼ŒStateHandlerImpl å®ç°åï¼Œç»§æ‰¿ StateConfigï¼Œå¯¹å¤–æä¾›åŒä¸€æœåŠ¡

```java
public interface IStateHandler {
    // å®šä¹‰ç›¸å…³å¤„ç†æ–¹æ³•
    Result handle(Long activityId, Enum<Constants.ActivityState> currentStatus);
}

@Component
public class StateHandlerImpl extends StateConfig implements IStateHandler {
    // é‡è½½å¤„ç†æ–¹æ³•å®ç°ï¼Œæ ¹æ®å½“å‰ä¼ å…¥çš„çŠ¶æ€è·å–ç›¸åº”çš„å¤„ç†æœåŠ¡æ“ä½œç›¸åº”çš„æµè½¬å˜æ›´
    @Override
    public Result handle(Long activityId, Enum<Constants.ActivityState>
                         currentStatus) {
        return stateGroup.get(currentStatus).oper(activityId, currentStatus);
    }
}
```

![image-20220219002759160](https://happychan.oss-cn-shenzhen.aliyuncs.com/img/image-20220219002759160.png)

## çŠ¶æ€æ¨¡å¼è‡ƒè‚¿çš„æ”¹è¿›æ–¹æ³•

åœ¨è¿™ä¸ªçŠ¶æ€å˜æ›´ä¸­ï¼Œä½¿ç”¨çŠ¶æ€æ¨¡å¼æ˜¾å¾—æœ‰äº›è‡ƒè‚¿ï¼Œæ¯ä¸ªçŠ¶æ€å®ç°ç±»éƒ½è¦å¤§é‡çš„å®ç°æ–¹æ³•è¿›è¡Œæ“ä½œ

ä¸‹é¢æä¾›äº†ä¸€ç§æ–°çš„æ ¡éªŒçŠ¶æ€æµè½¬çš„æ–¹å¼,å¦å¤–å¯¹çŠ¶æ€æµè½¬æœ‰éƒ¨åˆ†çš„è°ƒæ•´

```java
public enum ActivityStateEnum {

    /**
     * 1.ç¼–è¾‘
     */
    EDIT(1, "ç¼–è¾‘", Sets.newHashSet(/**ç¼–è¾‘*/1,/**æ’¤å®¡*/3,/**æ‹’ç»*/6)),
    /**
     * 2.æå®¡
     */
    ARRAIGNMENT(2, "æå®¡", Sets.newHashSet(/**ç¼–è¾‘*/1,/**æ’¤å®¡*/3)),

    /**
     * 3.æ’¤å®¡
     */
    REVOKE(3, "æ’¤å®¡", Sets.newHashSet(/**æå®¡*/2)),

    /**
     * 4.é€šè¿‡
     */
    PASS(4, "é€šè¿‡", Sets.newHashSet(/**æå®¡*/2)),

    /**
     * 5.æ´»åŠ¨(è¿è¡Œä¸­)
     */
    DOING(5, "æ´»åŠ¨(è¿è¡Œä¸­)", Sets.newHashSet(/**é€šè¿‡*/2,/**å¼€å¯*/8)),

    /**
     * 6.æ‹’ç»
     */
    REFUSE(6, "æ‹’ç»", Sets.newHashSet(/**æå®¡*/2)),

    /**
     * 7.å…³é—­
     */
    CLOSE(7, "å…³é—­", Sets.newHashSet(/**è¿è¡Œä¸­*/4,/**å¼€å¯*/4)),

    /**
     * 8.å¼€å¯
     */
    OPEN(8, "å¼€å¯", Sets.newHashSet(/**å…³é—­*/7));

    @Getter
    private final int code;

    @Getter
    private final String info;
    /**
     * å‰ç½®çŠ¶æ€,æœ‰å€¼æ—¶ï¼Œé›†åˆä¸­çš„çŠ¶æ€æ‰èƒ½æµè½¬ä¸ºæœ¬çŠ¶æ€
     */
    @Getter
    Set<Integer> previousStatusSet = null;

    ActivityStateEnum(int code, String info, Set<Integer> previousStatusSet) {
        this.code = code;
        this.info = info;
        this.previousStatusSet = previousStatusSet;
    }

    /**
     * æ£€æµ‹çŠ¶æ€æµè½¬æ˜¯å¦åˆç†
     *
     * @param oriStatus
     * @param nextStatus
     */
    public static void checkStatusTransfer(ActivityStateEnum oriStatus, ActivityStateEnum nextStatus) {
        if (oriStatus == null || nextStatus == null) {
            throw new IllegalStateException();
        }

        if (CollectionUtils.isNotEmpty(nextStatus.previousStatusSet) && !nextStatus.previousStatusSet.contains(oriStatus.code)) {
            throw new IllegalStateException();
        }
    }
}
```

## æ´»åŠ¨é¢†åŸŸæ„å»ºæµ‹è¯•

### å•å…ƒæµ‹è¯•

cn.happy.lottery.test.domain.ActivityTest

```java
@Test
public void test_alterState() {
    logger.info("æäº¤å®¡æ ¸ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.arraignment(100001L, Constants.ActivityState.EDIT)));
    logger.info("å®¡æ ¸é€šè¿‡ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.checkPass(100001L, Constants.ActivityState.ARRAIGNMENT)));
    logger.info("è¿è¡Œæ´»åŠ¨ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.doing(100001L, Constants.ActivityState.PASS)));
    logger.info("äºŒæ¬¡æå®¡ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.checkPass(100001L, Constants.ActivityState.EDIT)));
}
```

æµ‹è¯•éªŒè¯ä¹‹å‰å…ˆè§‚å¯Ÿä½ çš„æ´»åŠ¨æ•°æ®çŠ¶æ€ï¼Œå› ä¸ºåç»­ä¼šä¸æ–­çš„å˜æ›´è¿™ä¸ªçŠ¶æ€ï¼Œä»¥åŠå˜æ›´å¤±è´¥æé†’

- ä»ç¼–è¾‘çŠ¶æ€åˆ°æå®¡çŠ¶æ€
- ä»æå®¡çŠ¶æ€åˆ°å®¡æ ¸é€šè¿‡
- ä»å®¡æ ¸é€šè¿‡åˆ°æ´»åŠ¨è¿è¡Œï¼Œä¹Ÿå°±æ˜¯æ´»åŠ¨ä¸­
- æ¥ä¸‹æ¥å†äºŒæ¬¡æå®¡ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥å®¡æ ¸

**æµ‹è¯•ç»“æœ**

```java
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : æäº¤å®¡æ ¸ï¼Œæµ‹è¯•ï¼š{"code":"0000","info":"æ´»åŠ¨æå®¡æˆåŠŸ"}
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : å®¡æ ¸é€šè¿‡ï¼Œæµ‹è¯•ï¼š{"code":"0000","info":"æ´»åŠ¨å®¡æ ¸é€šè¿‡å®Œæˆ"}
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : è¿è¡Œæ´»åŠ¨ï¼Œæµ‹è¯•ï¼š{"code":"0000","info":"æ´»åŠ¨å˜æ›´æ´»åŠ¨ä¸­å®Œæˆ"}
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : äºŒæ¬¡æå®¡ï¼Œæµ‹è¯•ï¼š{"code":"0001","info":"ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸é€šè¿‡"}
```

- ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå¤„äºä¸åŒçŠ¶æ€ä¸‹çš„çŠ¶æ€æ“ä½œåŠ¨ä½œå’Œåé¦ˆç»“æœã€‚

## æ€»ç»“

------

1. æ³¨æ„ domainã€lottery-infrastructureï¼ŒåŒ…ç»“æ„è°ƒæ•´ï¼Œæ¶‰åŠåˆ° POM é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œåœ¨ lottery-infrastructure å¼•å…¥ domain çš„ POM é…ç½®
2. Activity æ´»åŠ¨é¢†åŸŸç›®å‰åªå¼€å‘äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼Œéœ€è¦æ³¨æ„å¦‚ä½•è€ƒè™‘æŠŠæ´»åŠ¨ä¸€ä¸ªç±»æ€è€ƒğŸ¤”å‡ºéƒ¨ç½²æ´»åŠ¨ã€é¢†å–æ´»åŠ¨å’ŒçŠ¶æ€æµè½¬çš„è®¾è®¡å®ç°
3. ç›®å‰æˆ‘ä»¬çœ‹åˆ°çš„æ´»åŠ¨åˆ›å»ºè¿˜æ²¡æœ‰ä¸€ä¸ªæ´»åŠ¨å·çš„è®¾è®¡ï¼Œä¸‹ä¸ªç« èŠ‚æˆ‘ä»¬ä¼šæ¶‰åŠåˆ°æ´»åŠ¨IDç­–ç•¥ç”Ÿæˆä»¥åŠé¢†å–æ´»åŠ¨çš„å•å·IDç”Ÿæˆã€‚

## é‡åˆ°çš„é—®é¢˜

### å¾ªç¯ä¾èµ–çš„é—®é¢˜

#### æ˜ç¡®èŒè´£åˆ’åˆ†ï¼Œé¿å…å¾ªç¯ä¾èµ–

lottery-domain ä¸­çš„ä»“å‚¨æœåŠ¡å®ç°å·²ç»è¿ç§»åˆ° lottery-infrastructureï¼Œè¯´æ˜ lottery-domain ä¸­åªéœ€è¦æ ¹æ®ä¸šåŠ¡å®šä¹‰ç›¸åº”çš„æ¥å£å³å¯ï¼ˆä¸æ¶‰åŠdaoç›¸å…³è°ƒç”¨çš„å…·ä½“å®ç°ï¼‰ï¼Œå› æ­¤ lottery-domain ä¸­å¹¶ä¸éœ€è¦å¼•ç”¨ lottery-infrastructure ï¼Œç›´æ¥åœ¨pom.xmlå»é™¤ç›¸å…³ä¾èµ–å³å¯

#### è§£å†³å¾ªç¯ä¾èµ–ï¼ˆå¦‚æœå®åœ¨æ˜¯ä¸å¯é¿å…å¤šæ¨¡å—å·¥ç¨‹ä¹‹é—´çš„ç›¸äº’è°ƒç”¨é—®é¢˜ï¼‰

##### 1ã€å€ŸåŠ©build-helper-maven-pluginæ’ä»¶è¿›è¡Œè§„é¿

è¿™ä¸ªæ’ä»¶æä¾›äº†ä¸€ç§è§„é¿æªæ–½ï¼Œå³ä¸´æ—¶åœ°å°†å·¥ç¨‹Aã€Bã€Cåˆå¹¶æˆä¸€ä¸ªä¸­é—´å·¥ç¨‹ï¼Œç¼–è¯‘å‡ºä¸´æ—¶çš„æ¨¡å— Dã€‚ç„¶åAã€Bã€Cå†åˆ†åˆ«ä¾èµ–ä¸´æ—¶æ¨¡å—Dè¿›è¡Œç¼–è¯‘ï¼‰ï¼Œä½†è¿™ç§æ–¹å¼åªæ˜¯ä¸€ç§è§„é¿æªæ–½ï¼Œå¹¶æ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³å·¥ç¨‹é—´ä¾èµ–å…³ç³»æ··ä¹±çš„é—®é¢˜

![image-20220219000937019](https://happychan.oss-cn-shenzhen.aliyuncs.com/img/image-20220219000937019.png)

##### 2ã€é‡æ„å·¥ç¨‹ï¼ˆä»æ ¹ä¸Šé˜²æ­¢ï¼‰

å¹³ç§»ï¼šä¾‹å¦‚Aã€Bç›¸äº’ä¾èµ–ï¼Œåˆ™å°†Bä¾èµ–Açš„ä»£ç å¹³ç§»åˆ°å·¥ç¨‹Bä¸­ï¼Œåˆ™Bä¸éœ€è¦ä¾èµ–ä¾èµ–Aï¼Œä»è€Œæ¶ˆé™¤å¾ªç¯ä¾èµ–

ä¸‹ç§»ï¼šä¾‹å¦‚Aã€Bäº’ç›¸ä¾èµ–ï¼Œä¸”Aã€Bä¾èµ–äºCï¼Œåˆ™å¯å°†Aã€Bä¸­ç›¸Läº’ä¾èµ–çš„éƒ¨åˆ†ä»£ç è¿ç§»åˆ°Cä¸­ï¼Œè®©Aã€Båªä¾èµ–äºCï¼Œä»è€Œæ¶ˆé™¤å¾ªç¯ä¾èµ–ï¼ˆè¿™ç§æ€è·¯å’Œä¸Šè¿°build-helper-maven-pluginçš„æ€è·¯æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ä¸€ä¸ªä»ç¼–è¯‘è¿‡ç¨‹ä¸­è§£å†³å¾ªç¯ä¾èµ–ï¼Œä¸€ä¸ªæ˜¯ä»å®ä½“é¡¹ç›®ç»“æ„è¿‡ç¨‹ä¸­è§£å†³ä¾èµ–ï¼‰

> å…·ä½“ä¾èµ–æ¶ˆé™¤çš„æ–¹å¼åˆ™è¦ç»“åˆå®é™…æƒ…å†µè¿›è¡Œåˆ†æï¼Œå¦‚æœèƒ½ä¼˜åŒ–å·¥ç¨‹ç»“æ„ä¸ºä¸Šç­–ï¼Œä½†æœ‰æ—¶å¾—è€ƒè™‘æ•´æ”¹æˆ
> æœ¬é—®é¢˜ï¼Œé€‰æ‹©æœ€åˆé€‚çš„æ–¹æ¡ˆï¼Œä½†å¯¹äºåˆå§‹åŒ–æ„å»ºé¡¹ç›®å·¥ç¨‹è€Œè¨€ä¸€å®šå¾—è€ƒè™‘å¥½å·¥ç¨‹é—´çš„ç»“æ„å…³ç³»ï¼Œæ‰“å¥½åŸº
> ç¡€ã€ç¡®å®šè§„èŒƒ

































